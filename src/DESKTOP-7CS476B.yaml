device:
  name: desktop
  version: "1.1"

platforms:
  - platform: plugins.mqtt
    id: mqtt
    host: home
    port: 1883

  - platform: plugins.console
    id: console

  - platform: plugins.web
    id: web
    port: 8888
    exports:
      - id: fakeGpio
        expose_state: state.is_high

  - platform: plugins.hass
    id: hass
    connection: mqtt
    exports:
      - id: fakeGpio
        type: switch
        expose_state: state.is_high

  - platform: plugins.gpio
    id: gpio
    type: mock


actions:
  - id: log
    platform: web
    type: UpdateAction

  - id: print
    platform: console
    type: PrintAction

  - id: fakeGpio
    platform: gpio
    type: BinaryAction
    pin: 0
    debug: true

sensors:
  - id: availability
    platform: mqtt
    topic: oo
    on_message:
      - conditions:
          - actual: "{{id(mqtt).is_connected}}"
            comperator: equals
            expected: True
        actions:
        - action: print
          values:
            payload: "I got a message and {{id(mqtt).is_connected}} == true"      

      - actions:
        - action: print
          values:
            payload: "Got message on topic '{{topic}}', with payload '{{payload}}'"


        
